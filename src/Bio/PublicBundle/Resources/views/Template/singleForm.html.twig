{% extends 'BioPublicBundle::main.html.twig' %}

{% block head %}
	{{parent()}}
		{% javascripts 'bundles/bioexam/js/Loader.js'
					   'bundles/bioexam/js/Parser.js'
					   'bundles/bioexam/js/Lister.js'
					   'bundles/bioexam/js/Notify.js' 'bundles/bioexam/js/Parser.js' output="js/*.js" %}
			<script src="{{asset_url}}"></script>
		{% endjavascripts %}
{% endblock %}

{% block content %}
	{{ form(form) }}
{% endblock %}

{% block java %}
	<script>
	var loader = new Loader({
		'url': '{{ url('main_page')}}crud/',
		'bundle': 'info',
		'entity': 'info',
		'table' : undefined,
		'buttons': undefined,
		'listeners': [
			{
				'selector': 'body',
				'event': 'loader-init',
				'fn': function(event, object, self) {
					self.sendRequest(self.generateUrl('global'), null, function(event, self) {
						console.log(this);
						self.notify.ready();
						if (this.success) {
							self.forms.open('set');
							self._handleForm(this.form);
							self.notify.success('Success.');
						} else {
							self.notify.failure(this.message);
						}
					});
				}
			}
		],
		'form': {
			'container': undefined,
			'form': document.querySelector('form'),
			'settings': {
				'set': {
					'before': function() {
						// do nothing
					},
					'onsubmit': function(event, form, container, self) {
						event.preventDefault();
						self.notify.wait();
						self.postForm(null, form, function(ajax) {
							var data = JSON.parse(ajax.responseText);
							self.notify.ready();
							if (data.success) {
								self.notify.success('Saved settings.');
							} else {
								self.notify.failure(data.message);
							}
						});
					},
					'after': function() {
						// never will be closed
					}
				}
			}
		}
	}); </script>
{% endblock %}