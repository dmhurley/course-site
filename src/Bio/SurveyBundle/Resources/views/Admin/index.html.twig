{% extends 'BioPublicBundle::main.html.twig' %}

{% block head %}
    {{ parent() }}
    {% stylesheets 'bundles/biosurvey/css/survey.css' filter="cssrewrite" output="css/*.css" %}
        <link rel="stylesheet" href="{{ asset_url }}" />
    {% endstylesheets %}
{% endblock %}

{% block content %}
    <h2>Create Survey</h2>
    <form method="POST" class="tableStyle">
        <div id="form">
            <div>
                <label for="form_name" class="required">Survey Name</label>
                <input type="text" id="form_name" name="form[name]" required="required">
            </div>
            <table>
                <thead>
                    <tr>
                        <th>Question</th>
                        <th>Delete</th>
                    </tr>
                    <tbody id="body">

                    </tbody>
                    <tfoot>
                        <tr>
                            <td colspan=2>
                                <table>
                                    <tr>
                                        <td style="text-align:center;"><span id="response">add question</span></td>
                                        <td style="text-align:center;"><span id="multiple">add multiple choice</span></td>
                                    </tr>
                                </table>
                            </td>
                        </tr>
                    </tfoot>
                </thead>
            </table>
            <div>
                <button type="submit">submit</button>
            </div>
        </div>
    </form>

    <h2>Download Surveys</h2>
    <table>
        <tr>
            <th>Name</th>
            <th>Questions</th>
            <th>Download</th>
            <th>Delete</th>
        </tr>
        {% for survey in surveys %}
            <tr>
                <td>{{survey.name}}</td>
                <td>{{survey.questions | length}}</td>
                <td><a href="">download</a></td>
                <td><a href="{{ path('delete_survey', {'id':survey.id}) }}">delete</a></td>
            </tr>
        {% else %}
            <tr><td colspan=4 style="text-align:center;">no surveys</td></tr>
        {% endfor %}
    </table>
{% endblock %}

{% block java %}
    <script>
        (function() {
            var body = document.getElementById('body')
                index = 0;

            document.body.addEventListener('click', function(evt) {
                if (evt.target.classList.contains('delete')) {
                    var tr = evt.target.parentElement;
                    tr.parentElement.removeChild(tr);
                }
            });

            document.getElementById('response').onclick = function() {
                var tr = document.createElement('tr');
                var left = document.createElement('td');
                var right = document.createElement('td');
                right.classList.add('delete');
                right.innerHTML = 'delete';

                var text = document.createElement('textarea');
                text.name="form["+index+"][]";

                left.appendChild(text);
                tr.appendChild(left);
                tr.appendChild(right);
                body.appendChild(tr);
                index++;
            }

            document.getElementById('multiple').onclick = function() {
                var tr = document.createElement('tr');
                var left = document.createElement('td');
                var right = document.createElement('td');
                right.classList.add('delete');
                right.innerHTML = 'delete';
                var question = document.createElement('textarea');
                question.name="form["+index+"][]";
                var add = document.createElement('a');
                add.innerHTML = 'add';
                left.appendChild(question);
                left.appendChild(add);
                var i = index;

                function addOption() {
                    var container = document.createElement('div');
                    var input = document.createElement('input');
                    var del = document.createElement('span');
                    container.appendChild(input);
                    container.appendChild(del);
                    del.classList.add('delete');
                    del.innerHTML = 'remove';
                    input.type = "text";
                    input.name = "form["+i+"][]";

                    left.insertBefore(container, add);
                }

                add.onclick = function() {
                    addOption();
                };

                addOption();

                tr.appendChild(left);
                tr.appendChild(right);

                body.appendChild(tr);
                index++;
            }
        })();
    </script>
{% endblock %}
